"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useJoinClause=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js");var _readEntity=require("../queries/readEntity"),_where=require("../queries/where"),_splitEntityProperty=require("./parsers/splitEntityProperty"),_siFunciona=_interopRequireDefault(require("si-funciona"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __awaiter=function(e,r,t,n){return new(t||(t=Promise))((function(i,o){function u(e){try{s(n.next(e))}catch(e){o(e)}}function a(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,a)}s((n=n.apply(e,r||[])).next())}))};const useJoinClause=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return __awaiter(void 0,[...r],void 0,(function(){let{propertyA:e=null,comparator:r="=",propertyB:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const{entity:o,property:u}=(0,_splitEntityProperty.splitEntityProperty)(e),{entity:a,property:s}=(0,_splitEntityProperty.splitEntityProperty)(t);return n.hasOwnProperty(o)||(n=yield(0,_readEntity.readEntity)(o,n)),n.hasOwnProperty(a)||(n=yield(0,_readEntity.readEntity)(a,n)),i.hasOwnProperty(o)||(i[o]=_siFunciona.default.cloneObject(n[o])),i.hasOwnProperty(a)||(i[a]=_siFunciona.default.cloneObject(n[a])),i[o]=i[a].reduce(((e,t)=>_siFunciona.default.mergeArrays(e,(0,_where.where)(i[o],{property:u,comparator:r,value:t[s]}))),[]),i[a]=i[o].reduce(((e,t)=>_siFunciona.default.mergeArrays(e,(0,_where.where)(i[a],{property:s,comparator:r,value:t[u]}))),[]),i}()}))};exports.useJoinClause=useJoinClause;