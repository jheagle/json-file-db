"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.runQuery=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js");var _deleteEntity=require("../queries/deleteEntity"),_insertEntity=require("../queries/insertEntity"),_readEntity=require("../queries/readEntity"),_updateEntity=require("../queries/updateEntity"),_joinEntity=require("../queries/joinEntity"),_mergeJoins=require("../queries/mergeJoins"),_where=require("../queries/where"),_sortBy=require("../queries/sortBy"),_groupBy=require("../queries/groupBy"),_retrieveRecord=require("./retrieveRecord"),_getConditionIndexedList=require("./getConditionIndexedList"),_getJoinIndexedList=require("./getJoinIndexedList"),__awaiter=function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function d(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(d,s)}u((r=r.apply(e,t||[])).next())}))};const runQuery=e=>__awaiter(void 0,void 0,void 0,(function*(){const t={[e.entity]:yield(0,_retrieveRecord.retrieveRecord)(e.entity)};void 0!==e.joinEntity&&(t[e.joinEntity]=yield(0,_retrieveRecord.retrieveRecord)(e.joinEntity));let i={[e.entity]:[]};switch(e=yield(0,_getConditionIndexedList.getConditionIndexedList)(e,t,i),(e=yield(0,_getJoinIndexedList.getJoinIndexedList)(e,t,i)).command){case"delete":i=yield(0,_deleteEntity.deleteEntity)(e.entity,i);break;case"insert":i=yield(0,_insertEntity.insertEntity)(e.entity,e.insertValues,i);break;case"read":i=yield(0,_readEntity.readEntity)(e.entity,i);break;case"update":i=yield(0,_updateEntity.updateEntity)(e.entity,e.updateValues,i);break;default:throw new Error(`Unknown command: ${e.command}`)}return i=yield(0,_joinEntity.joinEntity)(e.entity,e.joinEntity,i,e.joinClauses),i=yield(0,_mergeJoins.mergeJoins)(i,e.mergeJoins),i[e.entity]=e.conditions.reduce(((e,t)=>(0,_where.where)(e,t)),i[e.entity]),i[e.entity]=(0,_sortBy.sortBy)(i[e.entity],e.sortClauses),i[e.entity]=(0,_groupBy.groupBy)(i[e.entity],e.groupBy),i}));exports.runQuery=runQuery;