"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeJoin=void 0,require("core-js/modules/esnext.async-iterator.map.js"),require("core-js/modules/esnext.iterator.map.js");var _readEntity=require("../queries/readEntity"),_splitEntityProperty=require("./parsers/splitEntityProperty"),_where=require("../queries/where"),__awaiter=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{y(n.next(e))}catch(e){o(e)}}function s(e){try{y(n.throw(e))}catch(e){o(e)}}function y(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}y((n=n.apply(e,t||[])).next())}))};const mergeJoin=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return __awaiter(void 0,[...t],void 0,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const{entity:n,property:i}=(0,_splitEntityProperty.splitEntityProperty)(e),{entity:o,property:a}=(0,_splitEntityProperty.splitEntityProperty)(t);return r=yield(0,_readEntity.readEntity)(n,r),r=yield(0,_readEntity.readEntity)(o,r),r[n]=r[n].map((e=>{const t=(0,_where.where)(r[o],{property:a,comparator:"=",value:e[i]});if(!t.length)return e;const n=t[0];for(let t in n)t!==a&&(e[`${o}.${t}`]=n[t]);return e})),r}()}))};exports.mergeJoin=mergeJoin;