"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getConditionIndexedList=void 0;var _isEntityProperty=require("./parsers/isEntityProperty"),_splitEntityProperty=require("./parsers/splitEntityProperty"),_retrieveRecord=require("./retrieveRecord"),_where=require("../queries/where"),_retrieveFile=require("./retrieveFile"),_getMatchingIndexes=require("./getMatchingIndexes"),__awaiter=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function d(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,d)}c((i=i.apply(e,t||[])).next())}))};const getConditionIndexedList=(e,t,r)=>__awaiter(void 0,void 0,void 0,(function*(){let i=[];for(let o of e.conditions){let n=e.entity,s=o.property;if((0,_isEntityProperty.isEntityProperty)(s)){const e=(0,_splitEntityProperty.splitEntityProperty)(s);n=e.entity,s=e.property}t.hasOwnProperty(n)||(t[n]=yield(0,_retrieveRecord.retrieveRecord)(n));const d={},c=(e,t,r,i,o,n)=>__awaiter(void 0,void 0,void 0,(function*(){const r=(0,_where.where)(n[e][t],{property:"value",comparator:i.comparator,value:i.value});for(let t of r)for(let r of t.record)o[e].push(yield(0,_retrieveFile.retrieveFile)(`${e}/${r}`))}));(yield(0,_getMatchingIndexes.getMatchingIndexes)(n,s,t,o,r,d,c))||i.push(o)}return e.conditions=i,e}));exports.getConditionIndexedList=getConditionIndexedList;